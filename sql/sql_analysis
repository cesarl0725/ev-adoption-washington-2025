/*
Question 1: “What are the top 10 counties with the most electric cars?”
Analysis Query 1
- Purpose: To solve the first analysis question, "What are the top 10 counties with the most electric cars?". This is done by counting the
distinct rows of the table through the count() and grouping them by the county. Allowing us to discover the distribution of
electric vehicles by county.

- Code detail/insight: During the first version of this query, I made a vital mistake, as I did not use distinct within count()
making my result inaccurate, as Vin instances sometimes repeat. Thankfully, I caught on and fixed the error.
*/

CREATE TABLE question_1_view AS
SELECT
count(DISTINCT vin) AS electric_vehicle_count,
county
FROM
ev_adoption_port_project_processed
GROUP BY
county
HAVING
county IS NOT NULL
ORDER BY
electric_vehicle_count DESC
LIMIT
10
--------------------------------------------------------------------------------------------------------------------------------------
/*
Question 2: "What are the top 5 most popular car brands within the top 10 counties?"
Analysis Query 2
- Purpose: To see the number of EVs owned for each brand in each county to identify the 5 most popular
brands in each county during the visualization process.

- Code detail/insight during the production of this query, I had trouble deciding how to structure the COUNT() function.
After thinking over it, I decided to go with COUNT(DISTINCT vin) as this allows me to get only the unique vehicles in each
county.
*/

CREATE TABLE question_2_view AS
SELECT
make,
county,
COUNT(DISTINCT vin) AS Number_of_EVS
FROM
ev_adoption_port_project_processed
GROUP BY
make,county
ORDER BY
Number_of_EVS DESC
--------------------------------------------------------------------------------------------------------------------------------------
/*
Question 3: "Are fully electric cars (BEVs) more common than plug-in hybrids (PHEVs)?""
Analysis Query 3
- Purpose: To find the EV type for each distinct vin. This allows me to see which EV type is more popular
during the visualization process.

-Code detail/insight: To isolate the EV type of each vehicle, I used the Postgres unique function DISTINCT ON.
Because it allows me to extract only one row for that specific value, which in this case would be the vin.
*/

CREATE TABLE question_3_view AS
SELECT
DISTINCT ON (vin)
vin,
electric_vehicle_type
FROM
ev_adoption_port_project_processed
