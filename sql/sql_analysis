/*
Purpose: To answer the first business question, "What are the top 10 counties with the most electric/hybrid cars?". By counting
the number of unique vins per county, allowing me to see an accurate vehicle count for the top 10 counties.

Details/Insights: This query went through many variations as I kept running into the issue of counting the same vin in
multiple counties.The way I resolved this was by isolating each vin into one specific county, allowing me to view each
county's vin count in isolation. Additionally, I also made county into an aggregate function so I would 
not have to use it in my GROUP BY clause, as it could destroy my query.
*/

CREATE TABLE question_1_view AS
SELECT
county,
COUNT(*) AS ev_count
FROM
(
SELECT vin, MIN(TRIM(UPPER(county))) AS county
FROM ev_adoption_port_project_processed
WHERE county IS NOT NULL
GROUP BY vin
) one_per_vin
GROUP BY
county
ORDER BY
ev_count DESC
LIMIT 10;
--------------------------------------------------------------------------------------------------------------------------------------
/*
Question 2: "What are the top 5 most popular car brands within the top 10 counties?"
Analysis Query 2
- Purpose: To see the number of EVs/hybrids owned for each brand in each county to identify the 5 most popular
brands in each county during the visualization process.

- Code detail/insight during the production of this query, I had trouble deciding how to structure the COUNT() function.
After thinking over it, I decided to go with COUNT(DISTINCT vin) as this allows me to get only the unique vehicles in each
county.
*/

CREATE TABLE question_2_view AS
SELECT
make,
county,
COUNT(DISTINCT vin) AS Number_of_EVS
FROM
ev_adoption_port_project_processed
GROUP BY
make,county
ORDER BY
Number_of_EVS DESC
--------------------------------------------------------------------------------------------------------------------------------------
/*
Question 3: "Are fully electric cars (BEVs) more common than plug-in hybrids (PHEVs)?""
Analysis Query 3
- Purpose: To find the vehicle type for each distinct vin. This allows me to see which vehicle type is more popular
during the visualization process.

-Code detail/insight: To isolate the vehicle type of each vehicle, I used the Postgres unique function DISTINCT ON.
Because it allows me to extract only one row for that specific value, which in this case would be the vin.
*/

CREATE TABLE question_3_view AS
SELECT
DISTINCT ON (vin)
vin,
electric_vehicle_type
FROM
ev_adoption_port_project_processed
